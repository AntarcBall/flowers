<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Parametric Flower (Superformula)</title>
  <style>
    body { margin: 0; background:#0b0f14; color:#e8eef7; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .wrap { display:flex; flex-direction:column; gap:12px; padding:16px; max-width:900px; margin:0 auto; }
    canvas { background: radial-gradient(1200px 800px at 50% 35%, #152032, #070a0f); border:1px solid #223048; border-radius:12px; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    button {
      background:#1e2a42; color:#e8eef7; border:1px solid #2c3d5f;
      padding:10px 14px; border-radius:10px; cursor:pointer;
    }
    button:hover { background:#243251; }
    code, pre { background:#0f1624; border:1px solid #223048; border-radius:10px; padding:10px; overflow:auto; }
    .small { opacity:0.9; font-size:14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <button id="regen">랜덤 꽃 생성</button>
      <div class="small" id="params"></div>
    </div>

    <canvas id="cv" width="800" height="600"></canvas>

    <div class="small">
      팁: 새로고침 또는 “랜덤 꽃 생성”을 누르면 다른 파라미터로 다시 그립니다.
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById("cv");
  const ctx = canvas.getContext("2d");
  const paramsEl = document.getElementById("params");
  const btn = document.getElementById("regen");

  const TAU = Math.PI * 2;

  function rand(min, max) {
    return min + Math.random() * (max - min);
  }
  function randi(min, maxInclusive) {
    return Math.floor(rand(min, maxInclusive + 1));
  }

  // Gielis superformula (2D)
  // r(phi) = ( |cos(m*phi/4)/a|^n2 + |sin(m*phi/4)/b|^n3 )^(-1/n1)
  function superR(phi, m, n1, n2, n3, a = 1, b = 1) {
    const t1 = Math.pow(Math.abs(Math.cos(m * phi / 4) / a), n2);
    const t2 = Math.pow(Math.abs(Math.sin(m * phi / 4) / b), n3);
    const base = t1 + t2;

    // numeric safety
    if (base <= 0 || !Number.isFinite(base)) return 0;
    const r = Math.pow(base, -1 / n1);
    if (!Number.isFinite(r)) return 0;
    return r;
  }

  function pickRandomParams() {
    // "meaningful" ranges: avoid near-zero n1, keep exponents moderate
    const m = randi(4, 12);        // petals-ish
    const n1 = rand(0.25, 2.8);    // overall tightness
    const n2 = rand(0.25, 8.0);    // petal shape
    const n3 = rand(0.25, 8.0);    // petal shape
    const scale = rand(160, 260);  // pixels
    const rot = rand(0, TAU);      // radians
    return { m, n1, n2, n3, scale, rot };
  }

  function drawFlower(p) {
    const { m, n1, n2, n3, scale, rot } = p;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const cx = canvas.width / 2;
    const cy = canvas.height / 2;

    // styling
    const hue = rand(280, 360); // purple/pink-ish
    const fill = `hsla(${hue}, 85%, 60%, 0.28)`;
    const stroke = `hsla(${hue}, 90%, 70%, 0.95)`;
    const glow = `hsla(${hue}, 90%, 70%, 0.35)`;

    ctx.save();
    ctx.translate(cx, cy);

    // glow pass
    ctx.beginPath();
    const N = 1800; // point count
    for (let i = 0; i <= N; i++) {
      const phi = (i / N) * TAU;
      const r = superR(phi, m, n1, n2, n3) * scale;
      const x = r * Math.cos(phi + rot);
      const y = r * Math.sin(phi + rot);
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    }
    ctx.closePath();
    ctx.lineJoin = "round";
    ctx.lineCap = "round";

    ctx.shadowColor = glow;
    ctx.shadowBlur = 18;
    ctx.fillStyle = fill;
    ctx.fill();

    ctx.shadowBlur = 0;
    ctx.strokeStyle = stroke;
    ctx.lineWidth = 2.2;
    ctx.stroke();

    // simple center
    ctx.beginPath();
    ctx.arc(0, 0, Math.max(10, scale * 0.08), 0, TAU);
    ctx.fillStyle = "rgba(255, 220, 120, 0.75)";
    ctx.fill();
    ctx.strokeStyle = "rgba(255, 240, 200, 0.55)";
    ctx.lineWidth = 1.2;
    ctx.stroke();

    ctx.restore();

    paramsEl.textContent =
      `m=${m}, n1=${n1.toFixed(3)}, n2=${n2.toFixed(3)}, n3=${n3.toFixed(3)}, scale=${scale.toFixed(1)}, rot=${rot.toFixed(3)}rad`;
  }

  function regenerate() {
    const p = pickRandomParams();
    drawFlower(p);
  }

  btn.addEventListener("click", regenerate);
  regenerate();
})();
</script>
</body>
</html>
